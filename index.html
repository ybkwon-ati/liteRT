<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>LiteRT ì‹¤ì‹œê°„ ì „ì‚¬</title>
    <link rel="stylesheet" href="styles.css?v=3.0.0">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¤ LiteRT ì‹¤ì‹œê°„ ì „ì‚¬</h1>
            <p class="subtitle">ìŒì„±ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•©ë‹ˆë‹¤</p>
        </header>

        <main>
            <div class="control-panel">
                <button id="startBtn" class="btn btn-primary">
                    <span class="btn-icon">â–¶</span>
                    ì „ì‚¬ ì‹œì‘
                </button>
                <button id="stopBtn" class="btn btn-secondary" disabled>
                    <span class="btn-icon">â¹</span>
                    ì „ì‚¬ ì¤‘ì§€
                </button>
                <button id="clearBtn" class="btn btn-danger">
                    <span class="btn-icon">ğŸ—‘</span>
                    ê¸°ë¡ ì§€ìš°ê¸°
                </button>
                <button id="modelConfigBtn" class="btn btn-info" style="display: inline-flex !important; visibility: visible !important;">
                    <span class="btn-icon">ğŸ¤–</span>
                    ëª¨ë¸ ì„¤ì •
                </button>
            </div>

            <div class="status-bar">
                <span id="status" class="status">ëŒ€ê¸° ì¤‘...</span>
                <span id="language" class="language">ì–¸ì–´: í•œêµ­ì–´</span>
            </div>

            <div class="model-config-section">
                <div class="model-config-header">
                    <h3>ğŸ¤– AI ëª¨ë¸ ì„¤ì •</h3>
                </div>
                <div id="currentModel" class="current-model">
                    í˜„ì¬ ëª¨ë¸: <span id="currentModelName">ë¡œë”© ì¤‘...</span>
                </div>
            </div>

            <div id="modelConfigModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>AI ëª¨ë¸ ì„¤ì •</h2>
                        <button id="closeModal" class="btn-close-modal">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div class="model-source-tabs">
                            <button class="tab-btn active" data-tab="gallery">Edge Gallery</button>
                            <button class="tab-btn" data-tab="custom">ì§ì ‘ ì…ë ¥</button>
                            <button class="tab-btn" data-tab="downloaded">ë‹¤ìš´ë¡œë“œëœ ëª¨ë¸</button>
                        </div>

                        <div id="galleryTab" class="tab-content active">
                            <div class="model-search">
                                <input type="text" id="modelSearch" placeholder="ëª¨ë¸ ê²€ìƒ‰..." class="search-input">
                                <button id="searchBtn" class="btn-search">ê²€ìƒ‰</button>
                            </div>
                            <div class="model-list-container">
                                <div id="modelList" class="model-list">
                                    <div class="loading-models">ëª¨ë¸ ëª©ë¡ ë¡œë”© ì¤‘...</div>
                                </div>
                            </div>
                        </div>

                        <div id="customTab" class="tab-content">
                            <div class="custom-model-input">
                                <label for="customModelId">ëª¨ë¸ ID ì…ë ¥:</label>
                                <input type="text" id="customModelId" placeholder="ì˜ˆ: TinyLlama-1.1B-Chat-v0.4" class="model-input">
                                <p class="model-hint">WebLLMì—ì„œ ì§€ì›í•˜ëŠ” ëª¨ë¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                            </div>
                            <div class="preset-models">
                                <h4>ì¶”ì²œ ëª¨ë¸:</h4>
                                <div class="preset-list">
                                    <button class="preset-btn" data-model="TinyLlama-1.1B-Chat-v0.4">TinyLlama-1.1B-Chat-v0.4 (ê²½ëŸ‰)</button>
                                    <button class="preset-btn" data-model="Llama-3.2-3B-Instruct-q4f32_1">Llama-3.2-3B-Instruct (ì¤‘í˜•)</button>
                                    <button class="preset-btn" data-model="Phi-3-mini-4k-instruct-q4f32_1">Phi-3-mini-4k-instruct (ê²½ëŸ‰)</button>
                                    <button class="preset-btn" data-model="Qwen2.5-0.5B-Instruct-q4f32_1">Qwen2.5-0.5B-Instruct (ì´ˆê²½ëŸ‰)</button>
                                </div>
                            </div>
                        </div>

                        <div id="downloadedTab" class="tab-content">
                            <div class="downloaded-models-header">
                                <h4>ë‹¤ìš´ë¡œë“œëœ ëª¨ë¸ ëª©ë¡</h4>
                                <button id="refreshDownloadedBtn" class="btn-refresh">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                            </div>
                            <div class="model-list-container">
                                <div id="downloadedModelList" class="model-list">
                                    <div class="loading-models">ë‹¤ìš´ë¡œë“œëœ ëª¨ë¸ í™•ì¸ ì¤‘...</div>
                                </div>
                            </div>
                            <p class="model-hint" style="margin-top: 15px;">
                                ğŸ’¡ ëª¨ë¸ì€ ë¸Œë¼ìš°ì €ì˜ IndexedDBì— ì €ì¥ë©ë‹ˆë‹¤. ëª¨ë¸ ì‚­ì œëŠ” ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ IndexedDBë¥¼ ì§ì ‘ ì‚­ì œí•´ì•¼ í•©ë‹ˆë‹¤.
                            </p>
                        </div>

                        <div class="model-loading-status" id="modelLoadingStatus" style="display: none;">
                            <div class="loading-progress">
                                <div class="progress-bar">
                                    <div id="modelProgress" class="progress-fill"></div>
                                </div>
                                <span id="modelProgressText">0%</span>
                            </div>
                            <p id="modelStatusText">ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ì¤‘...</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="loadModelBtn" class="btn-load-model" disabled>ëª¨ë¸ ë¡œë“œ</button>
                        <button id="cancelModelBtn" class="btn-cancel">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>

            <div class="mic-level-container">
                <div class="mic-level-label">ë§ˆì´í¬ ë ˆë²¨</div>
                <div class="mic-level-bar">
                    <div id="micLevel" class="mic-level-fill"></div>
                </div>
                <span id="micLevelText" class="mic-level-text">0%</span>
            </div>

            <div class="transcription-area">
                <div class="transcription-header">
                    <h3>ì „ì‚¬ ê²°ê³¼</h3>
                    <div class="ai-actions">
                        <button id="translateBtn" class="btn-ai" title="ë²ˆì—­">
                            ğŸŒ ë²ˆì—­
                        </button>
                        <button id="summarizeBtn" class="btn-ai" title="ìš”ì•½">
                            ğŸ“ ìš”ì•½
                        </button>
                    </div>
                </div>
                <div id="transcription" class="transcription-text">
                    ì „ì‚¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                </div>
            </div>

            <div id="aiResultSection" class="ai-result-section" style="display: none;">
                <div class="ai-result-header">
                    <h3 id="aiResultTitle">AI ì²˜ë¦¬ ê²°ê³¼</h3>
                    <button id="closeAiResult" class="btn-close">âœ•</button>
                </div>
                <div id="aiResult" class="ai-result-content"></div>
            </div>

            <div class="history-section">
                <div class="history-header">
                    <h2>ğŸ“ ì „ì‚¬ ê¸°ë¡ ê´€ë¦¬</h2>
                    <button id="historyManageBtn" class="btn-history-manage">ğŸ“… ê¸°ë¡ ê´€ë¦¬</button>
                </div>
                <div id="history" class="history-list"></div>
            </div>

            <!-- ê¸°ë¡ ê´€ë¦¬ ëª¨ë‹¬ -->
            <div id="historyManageModal" class="modal" style="display: none;">
                <div class="modal-content history-modal-content">
                    <div class="modal-header">
                        <h2>ì „ì‚¬ ê¸°ë¡ ê´€ë¦¬</h2>
                        <button id="closeHistoryModal" class="btn-close-modal">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <!-- ê²€ìƒ‰ ë° í•„í„° -->
                        <div class="history-filters">
                            <div class="search-box">
                                <input type="text" id="historySearch" placeholder="ê¸°ë¡ ë‚´ìš© ê²€ìƒ‰..." class="search-input">
                                <button id="historySearchBtn" class="btn-search">ğŸ” ê²€ìƒ‰</button>
                            </div>
                            <div class="date-filters">
                                <div class="date-filter-item">
                                    <label>ë‚ ì§œ ì„ íƒ:</label>
                                    <input type="date" id="historyDateFilter" class="date-input">
                                    <button id="clearDateFilter" class="btn-clear-filter">ì´ˆê¸°í™”</button>
                                </div>
                                <div class="date-filter-item">
                                    <label>ê¸°ê°„ ì„ íƒ:</label>
                                    <input type="date" id="historyStartDate" class="date-input">
                                    <span>~</span>
                                    <input type="date" id="historyEndDate" class="date-input">
                                    <button id="applyDateRange" class="btn-apply-filter">ì ìš©</button>
                                </div>
                            </div>
                        </div>

                        <!-- ë‹¬ë ¥ ë·° -->
                        <div class="calendar-view">
                            <div class="calendar-header">
                                <button id="prevMonth" class="btn-calendar-nav">â—€</button>
                                <h3 id="currentMonthYear"></h3>
                                <button id="nextMonth" class="btn-calendar-nav">â–¶</button>
                            </div>
                            <div id="calendar" class="calendar-grid"></div>
                        </div>

                        <!-- ê¸°ë¡ ëª©ë¡ -->
                        <div class="history-list-section">
                            <h4>ê¸°ë¡ ëª©ë¡</h4>
                            <div id="historyManageList" class="history-manage-list">
                                <div class="loading-models">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="closeHistoryManageBtn" class="btn-cancel">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>LiteRT.js ê¸°ë°˜ ì‹¤ì‹œê°„ ì „ì‚¬ ì• í”Œë¦¬ì¼€ì´ì…˜</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/litert@latest/dist/litert.min.js"></script>
    <script>
        // WebLLM ë¡œë“œ - ì—¬ëŸ¬ CDN ì‹œë„
        (function() {
            const webllmSources = [
                'https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@latest/dist/index.js',
                'https://unpkg.com/@mlc-ai/web-llm@latest/dist/index.js'
            ];
            
            let currentSourceIndex = 0;
            
            function loadWebLLM() {
                if (currentSourceIndex >= webllmSources.length) {
                    console.error('WebLLMì„ ëª¨ë“  CDNì—ì„œ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    window.webllmLoadError = true;
                    return;
                }
                
                const script = document.createElement('script');
                script.src = webllmSources[currentSourceIndex];
                script.onload = function() {
                    window.webllmLoaded = true;
                    console.log('WebLLM loaded from:', webllmSources[currentSourceIndex]);
                    console.log('WebLLM types:', typeof webllm, typeof WebLLM, window.webllm, window.WebLLM);
                };
                script.onerror = function() {
                    console.warn('WebLLM ë¡œë“œ ì‹¤íŒ¨:', webllmSources[currentSourceIndex]);
                    currentSourceIndex++;
                    loadWebLLM(); // ë‹¤ìŒ CDN ì‹œë„
                };
                document.head.appendChild(script);
            }
            
            loadWebLLM();
        })();
    </script>
    <script>
        // ê°•ë ¥í•œ ìºì‹œ ë²„ìŠ¤íŒ… - íƒ€ì„ìŠ¤íƒ¬í”„ ì‚¬ìš©
        (function() {
            const timestamp = new Date().getTime();
            const script = document.createElement('script');
            script.src = `app.js?t=${timestamp}&v=3.0.0`;
            script.type = 'text/javascript';
            script.async = false;
            document.head.appendChild(script);
        })();
    </script>
</body>
</html>

